import{s as c,d as p,a as g,h as m}from"./loadingSpinner-D-kshPRo.js";import{s as f}from"./alertMessage-Dl9VQ_2y.js";import{a as h}from"./authGuard-DgJQJooe.js";import"./index-CWKkjwGO.js";async function y({title:a,description:r,tags:o,media:t,endsAt:n}){c();try{const e=await fetch(p,{headers:g(),method:"POST",body:JSON.stringify({title:a,description:r,tags:o,media:t,endsAt:n})});if(!e.ok){const i=await e.text();throw new Error("Failed to create post: "+i)}return await e.json()}catch(e){throw e.name==="TypeError"?alert("Network error, try again later"):alert(`Creating post failed: ${e.message}`),console.error("Creating post failed",e),e}finally{m()}}async function b(a){a.preventDefault();const r=a.target,o=new FormData(r),t=Object.fromEntries(o.entries());t.tags=t.tags?t.tags.split(",").map(i=>i.trim()):[];const n=document.querySelectorAll(".media-input"),e=[];n.forEach(i=>{const l=i.value.trim(),u=i.dataset.alt||"No description provided";l&&e.push({url:l,alt:u})}),t.media=e.length?e:null;const s=document.querySelector("#endsAt").value;if(s)t.endsAt=new Date(s).toISOString();else{alert("Please select an end date for the auction.");return}if(!t.title){alert("Title is required for creating a post");return}c();try{await y(t),f("Listing created!",3e3),r.reset(),document.getElementById("mediaFields").innerHTML="",d(),setTimeout(()=>{window.location.href="./profile/profile.html"},3e3)}catch(i){console.error("Error creating post: ",i),alert("Failed to create post. Please try again.")}finally{m()}}function d(){const a=document.getElementById("mediaFields");if(!a){console.error("Media fields container is missing.");return}const r=document.createElement("div");r.className="mb-4 relative";const o=document.createElement("label");o.setAttribute("for","media-url"),o.className="block text-sm font-body font-medium text-gray-700 mb-2 dark:text-gray-200 md:text-base",o.innerText="Image URL";const t=document.createElement("input");t.type="url",t.placeholder="Enter image URL",t.name="media-url",t.className="block w-full p-2 border rounded mb-2 media-input dark:bg-gray-800 dark:text-gray-100";const n=document.createElement("img");n.className="w-24 h-24 object-cover mt-2 hidden";const e=document.createElement("button");e.type="button",e.className="absolute top-[29px] right-0 bg-customGray text-white px-2 py-2 rounded cursor-pointer",e.innerText="X",e.addEventListener("click",()=>{r.remove()}),t.addEventListener("input",()=>{const s=t.value.trim();s?(n.src=s,n.classList.remove("hidden")):(n.classList.add("hidden"),n.src="")}),r.appendChild(o),r.appendChild(t),r.appendChild(n),r.appendChild(e),a.appendChild(r)}h();const w=document.forms.create;w.addEventListener("submit",b);function E(){const a=document.getElementById("addImageButton");a?a.addEventListener("click",d):console.error("Add Image button is not found in the DOM.")}E();d();

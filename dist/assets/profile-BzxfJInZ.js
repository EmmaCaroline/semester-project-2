import{a as T}from"./authGuard-DgJQJooe.js";import{l as f,s as k}from"./index-CWKkjwGO.js";import{s as l,a as E,h as u,c as v}from"./loadingSpinner-D-kshPRo.js";import{s as I}from"./alertMessage-Dl9VQ_2y.js";import{f as B,d as P,a as D}from"./listings-Cx42XGGI.js";import"./update-C0ONWQeW.js";async function p(e){const o=`${v}/${e}`;l();try{const t=await fetch(o,{headers:E(),method:"GET"});if(console.log(t),!t.ok){const a=await t.text();throw new Error("Failed to fetch profile: "+a)}const n=await t.json();return console.log(n),n.data}catch(t){throw t.name==="TypeError"?alert("Network error, try again later"):alert(`Fetching profile failed: ${t.message}`),console.error("Fetching profile failed: ",t),t}finally{u()}}const F=async()=>{l();const e=f("user");if(!e||!e.name){console.error("User is not logged in or user object is invalid");return}u();const o=e.name,t=await p(o),n=document.getElementById("banner-image"),a=document.getElementById("user-name"),r=document.getElementById("avatar-image"),s=document.getElementById("total-credits"),i=document.getElementById("bio"),c=document.getElementById("edit-profile-icon");c||console.error("Edit profile icon element not found."),n.src=t.banner?.url,n.alt=t.banner?.alt,a.textContent=o,r.src=t.avatar?.url,r.alt=t.avatar?.alt,s.textContent="Total credits: "+t.credits;const b=document.createElement("i");b.classList.add("fa-solid","fa-coins","ml-2","text-md","md:text-lg"),s.appendChild(b),i.textContent=t.bio||"No bio available",e.name===o?(c.classList.remove("hidden"),s.classList.remove("hidden")):(c.classList.add("hidden"),s.classList.add("hidden"))};async function j(){try{const o=f("user").name,t=await p(o),n=document.createElement("p");n.classList.add("text-sm","font-body","md:text-base"),n.textContent="Total: "+t._count.listings,document.querySelector("#listings-count").appendChild(n)}catch(e){console.error("Error fetching listing count:",e)}}async function A(){try{const o=f("user").name,t=await p(o),n=document.createElement("p");n.classList.add("text-sm","font-body","md:text-base"),n.textContent="Total: "+t._count.wins,document.querySelector("#wins-count").appendChild(n)}catch(e){console.error("Error fetching listing count:",e)}}async function U(e,o){const t=`${v}/${e}`;l();try{const n=await fetch(t,{headers:E(),method:"PUT",body:JSON.stringify(o)});if(!n.ok){const r=await n.text();throw new Error("Failed to update profile: "+r)}return await n.json()}catch(n){throw console.error("Updating profile failed: ",n),n}finally{u()}}async function N(e){e.preventDefault(),l();const o=f("user");if(!o||!o.name){console.error("User is not logged in or user object is invalid");return}u();const t=o.name,n=new FormData(e.target),a={},r=n.get("avatar-url"),s=n.get("banner-url"),i=n.get("bio"),c=await p(t);r&&r!==c.avatar?.url&&(a.avatar={url:r,alt:n.get("avatar-alt")}),s&&s!==c.banner?.url&&(a.banner={url:s,alt:n.get("banner-alt")}),i&&i!==c.bio&&(a.bio=i),Object.keys(a).length>0?(l(),await U(t,a),I("Profile is now updated",3e3),setTimeout(()=>{window.location.reload()},3e3)):(I("No changes were made to the profile.",3e3),setTimeout(()=>{window.location.reload()},3e3)),u()}async function $(){l();const e=f("user");if(!e||!e.name){console.error("User is not logged in or user object is invalid");return}const o=e.name,t=await p(o),n=document.forms.updateProfile.elements.bio;n&&t.bio&&(n.value=t.bio),u()}async function S(e){const o=`${v}/${e}/wins?_seller=true&_bids=true`;l();try{const t=await fetch(o,{headers:E(),method:"GET"});if(!t.ok){const a=await t.text();throw new Error("Failed to fetch wins: "+a)}return(await t.json()).data}catch(t){throw t.name==="TypeError"?alert("Network error, try again later"):alert(`Fetching wins failed: ${t.message}`),console.error("Fetching wins failed: ",t),t}finally{u()}}async function _(e){const o=document.createElement("a");if(!o)return console.error("Failed to create listing container for:",e),null;o.setAttribute("aria-label","View listing"),o.classList.add("border","border-2","rounded","border-bg-#92A6B4","shadow-lg","flex","flex-col","transition","duration-300","ease-linear","group");const t=document.createElement("div");t.classList.add("flex","justify-between","items-center","py-2","px-2");const n=document.createElement("div");n.classList.add("flex","items-center");const a=document.createElement("p");a.classList.add("text-sm","font-body","md:text-base"),a.textContent=e.seller.name;const r=document.createElement("img");r.classList.add("w-8","h-8","rounded-full","mr-2"),e.seller?.avatar?(r.src=e.seller.avatar.url,r.alt=e.seller.avatar.alt):(r.src="",r.alt=""),n.append(r,a);const s=document.createElement("p");s.classList.add("text-sm","font-body","md:text-base"),s.textContent="Bids: "+e._count.bids,t.append(n,s);const i=document.createElement("p");i.classList.add("py-2","px-2","text-sm","font-body","md:text-base");const c=new Date;if(new Date(e.endsAt)>c){const x=document.createElement("span");x.classList.add("text-red-600","text-sm","font-body","md:text-base","font-medium"),x.textContent=B(e.endsAt),i.textContent="Ends at: ",i.appendChild(x)}else i.textContent="Auction ended",i.classList.add("text-gray-500","italic","text-sm","font-body","md:text-base");const h=document.createElement("div");h.classList.add("aspect-square","overflow-hidden","mb-3");const m=document.createElement("img");m.classList.add("object-cover","object-center","aspect-square","w-full","cursor-pointer","transition","duration-300","ease-linear","group-hover:scale-105"),e.media?.[0]?(m.src=e.media[0].url,m.alt=e.media[0].alt):(m.src=P,m.alt="No image available"),h.appendChild(m);const C=()=>{k("listingID",e.id),window.location.href="./listing/listing.html"};m.addEventListener("click",C);const w=document.createElement("h2");w.textContent=e.title||"Untitled",w.classList.add("font-heading","text-xl","truncate","dark:text-gray-100","pb-4","px-2");const g=document.createElement("div");g.classList.add("flex","justify-center","mb-4");const y=document.createElement("button");y.classList.add("w-auto","font-body","text-sm","py-1.5","px-8","rounded-lg","md:text-base","bg-customGray","text-white","hover:bg-gray-400"),y.textContent="View items",g.appendChild(y),g.addEventListener("click",C),o.append(t,i,h,w,g);const L=document.querySelector(".wins-container");return L.appendChild(o),L}async function q(){l();try{l();const e=f("user");if(!e||!e.name){console.error("User is not logged in or user object is invalid");return}const o=e.name,t=await S(o);if(!t||t.length===0){console.warn("No wins found for user:",o);return}t.forEach(n=>{_(n)})}catch(e){console.error("Error reading wins:",e)}finally{u()}}const d=document.forms.updateProfile;d.addEventListener("submit",N);const R=document.getElementById("cancel-update");R.addEventListener("click",function(e){e.preventDefault(),d.classList.add("hidden")});document.getElementById("update-profile-button").addEventListener("click",function(){if(d.classList.contains("hidden")){d.classList.remove("hidden"),d.classList.add("block"),$();const o=d.offsetTop;window.scrollTo({top:o-90,behavior:"smooth"})}else d.classList.add("hidden"),d.classList.remove("block")});T();F();D();j();A();q();

import{d as l,a as d,s as p,h,c as f}from"./loadingSpinner-D-kshPRo.js";import{l as u}from"./index-CWKkjwGO.js";async function L(o=24,i=1,n=!0,a="created",e="desc",s=!1){const t=new URL(l);t.searchParams.append("limit",o),t.searchParams.append("page",i),t.searchParams.append("_seller",n),t.searchParams.append("sort",a),t.searchParams.append("sortOrder",e),s!==!1&&t.searchParams.append("_active",s),p();try{const r=await fetch(t,{headers:d(),method:"GET"});if(!r.ok){const m=await r.text();throw new Error("Failed to fetch posts: "+m)}return await r.json()}catch(r){throw console.error("Fetching listings failed: ",r),r}finally{h()}}async function x(o=24,i=1,n=!0,a=!1,e="art"){const s=new URL(l);s.searchParams.append("limit",o),s.searchParams.append("page",i),s.searchParams.append("_seller",n),s.searchParams.append("_tag",e),a!==!1&&s.searchParams.append("_active",a),p();try{const t=await fetch(s,{headers:d(),method:"GET"});if(!t.ok){const c=await t.text();throw new Error("Failed to fetch posts: "+c)}return await t.json()}catch(t){throw console.error("Fetching listings failed: ",t),t}finally{h()}}async function b(o=24,i=1,n=!0,a=!1,e="books"){const s=new URL(l);s.searchParams.append("limit",o),s.searchParams.append("page",i),s.searchParams.append("_seller",n),s.searchParams.append("_tag",e),a!==!1&&s.searchParams.append("_active",a),p();try{const t=await fetch(s,{headers:d(),method:"GET"});if(!t.ok){const c=await t.text();throw new Error("Failed to fetch posts: "+c)}return await t.json()}catch(t){throw console.error("Fetching listings failed: ",t),t}finally{h()}}async function T(o=24,i=1,n=!0,a=!1,e="jewelry"){const s=new URL(l);s.searchParams.append("limit",o),s.searchParams.append("page",i),s.searchParams.append("_seller",n),s.searchParams.append("_tag",e),a!==!1&&s.searchParams.append("_active",a),p();try{const t=await fetch(s,{headers:d(),method:"GET"});if(!t.ok){const c=await t.text();throw new Error("Failed to fetch posts: "+c)}return await t.json()}catch(t){throw console.error("Fetching listings failed: ",t),t}finally{h()}}async function w(o,i=!0,n=!0){try{const a=new URL(`${l}/${o}`);a.searchParams.append("_seller",i),a.searchParams.append("_bids",n),console.log("API Endpoint:",a.toString());const e=await fetch(a,{headers:d(),method:"GET"});if(!e.ok){const t=await e.text();throw new Error("Failed to fetch post: "+t)}return await e.json()}catch(a){throw console.error("Fetching post failed: ",a),a}}async function F(o="myUniqueTag932"){const i=new URL(l);i.searchParams.append("_tag",o),p();try{const n=await fetch(i,{headers:d(),method:"GET"});if(!n.ok){const e=await n.text();throw new Error("Failed to fetch posts: "+e)}return await n.json()}catch(n){throw console.error("Fetching listings failed: ",n),n}finally{h()}}async function _(o,i=!0,n=!1){const a=new URL(`${f}/${o}/listings`);a.searchParams.append("_seller",i),n!==!1&&a.searchParams.append("_active",n),p();try{const e=await fetch(a,{headers:d(),method:"GET"});if(!e.ok){const t=await e.text();throw new Error("Failed to fetch posts: "+t)}return await e.json()}catch(e){throw console.error("Fetching listings failed: ",e),e}finally{h()}}async function y(o,{title:i,description:n,tags:a,media:e}){const s={title:i,description:n,tags:a,media:e};try{const t=await fetch(`${l}/${o}`,{headers:d(),method:"PUT",body:JSON.stringify(s)});if(!t.ok){const c=await t.text();throw new Error("Failed to update listing: "+c)}return await t.json()}catch(t){throw console.error("Updating listing failed:",t),t}}async function k(o){o.preventDefault();const i=new URLSearchParams(window.location.search).get("id"),n=new FormData(o.target),a=await w(i),e={title:n.get("title")||"",description:n.get("description")||"",tags:n.get("tags")?n.get("tags").split(",").map(r=>r.trim()):[],media:[]};if(document.querySelectorAll(".media-input").forEach(r=>{const c=r.value.trim(),m=r.dataset.alt||"No description";c&&e.media.push({url:c,alt:m})}),e.title===a.data.title&&e.description===a.data.description&&JSON.stringify(e.tags)===JSON.stringify(a.data.tags)&&JSON.stringify(e.media)===JSON.stringify(a.data.media)){alert("No changes made to the listing.");return}try{p(),await y(i,e),alert("Listing updated successfully!"),window.location.href=`./listing/listing.html/?id=${i}`}catch(r){console.error("Failed to update listing:",r),alert("Failed to update listing.")}h()}const g=document.getElementById("cancelButton");g&&g.addEventListener("click",()=>{window.location.href=`./listing/listing.html/?id=${new URLSearchParams(window.location.search).get("id")}`});const D=(o,i)=>{const a=u("user")?.name,e=document.getElementById("edit-listing-button-container");if(!e){console.error("Edit button not found.");return}e.style.display="none",i===a&&(e.innerText="Edit Post",e.style.display="block",e.addEventListener("click",()=>{window.location.href=`./listing/update-listing.html/?id=${o.id}`}))};function U(o="",i="",n=0){const a=document.getElementById("mediaFields");if(!a){console.error("Media fields container is missing.");return}const e=document.createElement("div");e.className="mb-4 relative";const s=document.createElement("label");s.setAttribute("for",`media-url-${n}`),s.className="block text-sm font-body font-medium text-gray-700 mb-2 dark:text-gray-200 md:text-base",s.innerText="Image URL";const t=document.createElement("input");t.type="url",t.placeholder="Enter image URL",t.name=`media-url-${n}`,t.className="block w-full p-2 border rounded mb-2 media-input dark:bg-gray-800 dark:text-gray-100",t.value=o;const r=document.createElement("img");r.className="w-24 h-24 object-cover mt-2 hidden",o&&(r.src=o,r.alt=i,r.classList.remove("hidden"));const c=document.createElement("button");c.type="button",c.className="absolute top-[29px] right-0 bg-customGray text-white px-2 py-2 rounded cursor-pointer",c.innerText="X",c.addEventListener("click",()=>{e.remove()}),t.addEventListener("input",()=>{const m=t.value.trim();m?(r.src=m,r.alt=i||"No description",r.classList.remove("hidden")):(r.classList.add("hidden"),r.src="",r.alt="")}),e.appendChild(s),e.appendChild(t),e.appendChild(r),e.appendChild(c),a.appendChild(e)}export{F as a,x as b,b as c,T as d,w as e,L as f,_ as g,U as h,k as i,D as o};

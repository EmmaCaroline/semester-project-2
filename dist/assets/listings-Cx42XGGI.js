import{e as k,f as N,b as U,c as O,d as _,o as $,g as J}from"./update-C0ONWQeW.js";import{l as T,s as M}from"./index-CWKkjwGO.js";import{d as P,a as q,s as L,h as C}from"./loadingSpinner-D-kshPRo.js";const j=""+new URL("No_Image_Available-Cvya9Jub.jpg",import.meta.url).href;async function G(t){if(!t||typeof t!="string")throw new Error("Invalid post ID: must be a valid string (UUID).");try{const e=`${P}/${t}`,a=await fetch(e,{method:"DELETE",headers:q()});if(!a.ok){const n=await a.text();throw new Error("Failed to delete post: "+n)}}catch(e){throw console.error("Deleting post failed: ",e),e}}async function H(t,e){const n=T("user")?.name,o=document.getElementById("delete-button-container");e===n?(o.innerText="Delete Post",o.dataset.postId=t.id,o.style.display="block",o.addEventListener("click",V)):o.style.display="none"}async function V(t){const e=t.target.dataset.postId;if(!e){console.error("Invalid post ID:",e),alert("Invalid post ID. Could not delete the post.");return}const a=confirm("Are you sure you want to delete this post?");try{a?(await G(e),alert("The post was deleted"),window.location.href="./profile/profile.html"):window.location.reload()}catch(n){console.error("The post could not be deleted:",n),alert("Failed to delete the post.")}}async function Y(t,{amount:e}){const a={amount:e};try{const n=await fetch(`${P}/${t}/bids`,{headers:q(),method:"POST",body:JSON.stringify(a)});if(!n.ok){const s=await n.text();throw new Error("Failed to fetch bid: "+s)}return await n.json()}catch(n){throw console.error("Fetching bid failed:",n),n}}function F(t){return t&&Array.isArray(t.bids)&&t.bids.length>0?t.bids.sort((a,n)=>n.amount-a.amount)[0].amount:null}function Q(t){const e=new Date,a=new Date(t.endsAt);return e>a}function X(t){const e=document.querySelector(".single-listing-container");if(!e){console.error("Container not found!");return}const a=new Date,n=new Date(t.endsAt),o=a>n?"Auction ended: ":"Auction ends at: ",s=document.createElement("div");s.classList.add("bid-section","flex","flex-col","justify-center","items-center","border","border-bg-customBlue","rounded","my-4","dark:text-gray-300");const d=document.createElement("h3"),r=document.createElement("span");r.textContent=B(t.endsAt),r.classList.add("text-red-600"),d.textContent=o,d.appendChild(r),d.classList.add("font-body","text-base","font-medium","md:text-lg","mt-4","mb-8"),s.appendChild(d);const g=document.createElement("div");g.classList.add("bid-amount-container");const b=F(t),m=document.createElement("p");if(m.classList.add("font-body","text-sm","md:text-base","mb-4","dark:text-gray-300"),Q(t)?m.textContent=b?`Final bid was: $${b}`:"No bids was placed on this listing":m.textContent=b?`Current bid: $${b}`:"No bids yet",g.appendChild(m),s.appendChild(g),a<=n){const c=document.createElement("label");c.setAttribute("for","bidAmountInput"),c.classList.add("font-body","text-sm","md:text-base","mx-2","mb-1"),c.textContent="Place your bid:";const l=document.createElement("input");l.classList.add("font-body","text-sm","md:text-base","border","border-black","rounded","pl-2","py-1","w-24","md:w-28","mb-4","dark:bg-gray-800"),l.setAttribute("type","number"),l.setAttribute("id","bidAmountInput"),l.setAttribute("placeholder","Bid amount"),l.setAttribute("min",b?b+1:1);const f=document.createElement("button");f.classList.add("w-auto","font-body","text-sm","py-1.5","px-8","rounded-lg","md:text-base","bg-customGray","text-white","hover:bg-gray-400","mb-4"),f.textContent="Place Bid",f.setAttribute("id","placeBidButton"),f.addEventListener("click",()=>{const i=parseFloat(l.value);if(isNaN(i)||i<=(b||0)){alert("Please enter a valid bid that is higher than the current bid.");return}z(t.id,i,l)});const p=document.createElement("div");p.classList.add("flex","flex-col");const h=document.createElement("p");return h.classList.add("font-body","text-base","md:text-lg","font-medium","mt-6","pb-4","dark:text-gray-300"),h.textContent="List of bidders:",t.bids&&Array.isArray(t.bids)&&t.bids.length>0&&t.bids.forEach(i=>{const u=document.createElement("div");u.classList.add("flex","items-center","mb-2","dark:text-gray-300");const y=document.createElement("img");y.classList.add("w-8","h-8","rounded-full","mr-2"),i.bidder?.avatar?(y.src=i.bidder.avatar.url,y.alt=i.bidder.avatar.alt):(y.src="",y.alt="");const x=document.createElement("p");x.classList.add("font-body","text-sm","md:text-base"),x.textContent=`${i.bidder.name}: $${i.amount}`,u.appendChild(y),u.appendChild(x),p.appendChild(u)}),s.append(c,l,f,h,p),s}e.appendChild(s)}async function z(t,e,a){try{await Y(t,{amount:e});const n=await k(t);if(!n||!n.data){console.error("Updated listing data is missing:",n);return}K(n.data),a.value="",a.setAttribute("min",e+1),alert(`Your bid of $${e} has been placed successfully!`)}catch(n){console.error("Error placing bid:",n),alert("Failed to place bid. Please try again. Note that you cannot bid on your own listing.")}}function K(t){const e=document.querySelector(".bid-amount-container");if(!e){console.error("Bid amount container not found.");return}const a=F(t);let n=e.querySelector("p");n||(n=document.createElement("p"),e.appendChild(n)),a!==null?n.textContent=`Current bid: $${a}`:n.textContent="No bids yet"}function B(t){const e=new Date(t),a=String(e.getDate()).padStart(2,"0"),n=e.toLocaleString("en-US",{month:"short"}),o=e.getFullYear(),s=String(e.getHours()).padStart(2,"0"),d=String(e.getMinutes()).padStart(2,"0");return`${a} ${n} ${o}, ${s}:${d}`}async function E(t){const e=document.createElement("a");if(!e)return console.error("Failed to create listing container for:",t),null;e.setAttribute("aria-label","View listing"),e.classList.add("border","border-2","rounded","border-bg-#92A6B4","dark:border-gray-800","shadow-lg","flex","flex-col","transition","duration-300","ease-linear","group");const a=document.createElement("div");a.classList.add("flex","justify-between","items-center","py-2","px-2","dark:text-gray-300");const n=document.createElement("div");n.classList.add("flex","items-center");const o=document.createElement("p");o.classList.add("text-sm","font-body","md:text-base"),o.textContent=t.seller.name;const s=document.createElement("img");s.classList.add("w-8","h-8","rounded-full","mr-2"),t.seller?.avatar?(s.src=t.seller.avatar.url,s.alt=t.seller.avatar.alt):(s.src="",s.alt=""),n.append(s,o);const d=document.createElement("p");d.classList.add("text-sm","font-body","md:text-base"),d.textContent="Bids: "+t._count.bids,a.append(n,d);const r=document.createElement("p");r.classList.add("py-2","px-2","text-sm","font-body","md:text-base","dark:text-gray-300");const g=new Date;if(new Date(t.endsAt)>g){const u=document.createElement("span");u.classList.add("text-red-600","text-sm","font-body","md:text-base","font-medium"),u.textContent=B(t.endsAt),r.textContent="Ends at: ",r.appendChild(u)}else r.textContent="Auction ended",r.classList.add("text-gray-500","italic","text-sm","font-body","md:text-base");const m=document.createElement("div");m.classList.add("aspect-square","overflow-hidden","mb-3");const c=document.createElement("img");c.classList.add("object-cover","object-center","aspect-square","w-full","cursor-pointer","transition","duration-300","ease-linear","group-hover:scale-105"),t.media?.[0]?(c.src=t.media[0].url,c.alt=t.media[0].alt):(c.src=j,c.alt="No image available"),m.appendChild(c);const l=()=>{M("listingID",t.id),window.location.href="./listing/listing.html"};c.addEventListener("click",l);const f=document.createElement("h2");f.textContent=t.title||"Untitled",f.classList.add("font-heading","text-xl","truncate","dark:text-gray-100","pb-4","px-2");const p=document.createElement("div");p.classList.add("flex","justify-center","mb-4");const h=document.createElement("button");h.classList.add("w-auto","font-body","text-sm","py-1.5","px-8","rounded-lg","md:text-base","bg-customGray","text-white","hover:bg-gray-400"),h.textContent="View items",p.appendChild(h),p.addEventListener("click",l),e.append(a,r,m,f,p);const i=document.querySelector(".listings-container");return i.appendChild(e),i}function W(t,e){const a=t.value.toLowerCase(),n=e.filter(s=>s.title.toLowerCase().includes(a)),o=document.querySelector(".listings-container");o.innerHTML="",n.forEach(s=>E(s))}function Z(t){const e=t.value;let a="created",n="desc",o=!1;e==="newest"?(a="created",n="desc"):e==="oldest"?(a="created",n="asc"):e==="ending-soon"&&(a="endsAt",n="asc",o=!0),N(void 0,void 0,void 0,a,n,o).then(s=>s.data).then(s=>{const d=document.querySelector(".listings-container");d.innerHTML="",s.forEach(r=>E(r))}).catch(s=>console.error("Error fetching listings:",s))}async function tt(t){const e=document.querySelector(".single-listing-container"),a=document.createElement("div");a.classList.add("flex","flex-col","sm:flex-row","sm:w-full","overflow-hidden");const n=document.createElement("div");n.classList.add("w-full","md:w-1/2","h-80","lg:h-[450px]","overflow-hidden","relative");const o=document.createElement("div");o.classList.add("flex","transition-transform","duration-500");const s=t.data.media&&t.data.media.length>0?t.data.media:[{url:j,alt:"No image available"}];s.forEach(v=>{const S=document.createElement("div");S.classList.add("flex-shrink-0","w-full");const A=document.createElement("img");A.classList.add("object-cover","object-center","aspect-square","sm:aspect-4/3","w-full"),A.src=v.url,A.alt=v.alt,S.appendChild(A),o.appendChild(S)});const d=document.createElement("button");d.classList.add("prev-btn","absolute","top-1/2","left-3","transform","translate-y-[-50%]","bg-black","text-white","px-2","py-2","rounded","bg-opacity-60");const r=document.createElement("i");r.classList.add("fa-solid","fa-arrow-left"),d.appendChild(r);const g=document.createElement("button");g.classList.add("next-btn","absolute","top-1/2","right-3","transform","translate-y-[-50%]","bg-black","text-white","px-2","py-2","rounded","bg-opacity-60");const b=document.createElement("i");b.classList.add("fa-solid","fa-arrow-right"),g.appendChild(b),n.appendChild(o),n.appendChild(d),n.appendChild(g);let m=0;function c(){const v=-m*100;o.style.transform=`translateX(${v}%)`}d.addEventListener("click",()=>{m=(m-1+s.length)%s.length,c()}),g.addEventListener("click",()=>{m=(m+1)%s.length,c()});const l=document.createElement("div");l.classList.add("w-full","md:w-1/2","sm:p-4","ml-8","sm:ml-1","mt-4","sm:mt-0","dark:text-gray-300");const f=document.createElement("h2");f.classList.add("font-heading","text-3xl","lg:text-4xl","font-bold","mb-4","mr-8","lg:mr-20"),f.textContent=t.data.title;const p=document.createElement("div");p.classList.add("flex","justify-between","items-center","mr-14","sm:mr-8");const h=document.createElement("div");h.classList.add("flex","items-center","mb-4");const i=document.createElement("p");i.classList.add("font-body","text-sm","md:text-base"),i.textContent=t.data.seller.name;const u=document.createElement("img");u.classList.add("w-8","h-8","rounded-full","mr-2"),t.data.seller?.avatar?(u.src=t.data.seller.avatar.url,u.alt=t.data.seller.avatar.alt):(u.src="",u.alt=""),h.append(u,i);const y=document.createElement("p");y.classList.add("mb-4","font-body","text-sm","md:text-base"),y.textContent="Bids: "+t.data._count.bids,p.append(h,y);const x=document.createElement("p");x.classList.add("text-sm","font-body","md:text-base","mb-4","text-gray-600"),x.textContent="Listed: "+B(t.data.created);const I=document.createElement("p");I.classList.add("font-body","text-sm","md:text-base","mr-8","lg:mr-20"),I.textContent=t.data.description,l.append(f,p,x,I),a.append(n,l);let w=document.getElementById("edit-listing-button-container");w||(w=document.createElement("button"),w.id="edit-listing-button-container",w.classList.add("btn","btn-primary","my-4","dark:text-gray-200","dark:border-gray-400"),w.style.display="none",w.innerText="Edit Post");const D=t.data,R=D.seller.name;return $(D,R),e.append(a,w),e}async function st(){L();try{const t=await N(),e=Array.isArray(t.data)?t.data:[];if(e.length===0){console.warn("No listings found in the response.");return}if(window.location.pathname==="./"){window.listingsArray=e;const a=document.getElementById("search-input"),n=document.getElementById("sort-select");a.addEventListener("keyup",()=>W(a,e)),n.addEventListener("change",()=>Z(n,e))}e.forEach(a=>{E(a)})}catch(t){console.error("Error reading all listings:",t)}finally{C()}}async function ot(){L();try{const t=await U(),e=Array.isArray(t.data)?t.data:[];if(e.length===0){console.warn("No listings found in the response.");return}e.forEach(a=>{E(a)})}catch(t){console.error("Error reading all listings:",t)}finally{C()}}async function rt(){L();try{const t=await O(),e=Array.isArray(t.data)?t.data:[];if(e.length===0){console.warn("No listings found in the response.");return}e.forEach(a=>{E(a)})}catch(t){console.error("Error reading all listings:",t)}finally{C()}}async function dt(){L();try{const t=await _(),e=Array.isArray(t.data)?t.data:[];if(e.length===0){console.warn("No listings found in the response.");return}e.forEach(a=>{E(a)})}catch(t){console.error("Error reading all listings:",t)}finally{C()}}async function it(){const t=localStorage.getItem("listingID");if(!t){console.error("No listing ID found in localStorage");return}try{const e=JSON.parse(t);if(typeof e!="string")throw new Error("Invalid listing ID");try{console.log("Attempting to fetch and create listing..."),L();const a=await k(e),n=a.data,o=n.seller.name;H(n,o),$(n,o),await tt(a);const s=localStorage.getItem("token"),d=document.querySelector(".single-listing-container");if(s){const r=X(n);r instanceof Node?document.querySelector(".single-listing-container").appendChild(r):console.error("Failed to create a valid bid section.")}else{const r=document.createElement("p");r.classList.add("font-body","text-sm","md:text-base","text-center","mt-4"),r.textContent="Please log in to view more info about this listing and to place a bid.",d.appendChild(r)}}catch(a){console.error("Error reading single listing: ",a)}finally{C()}}catch(e){console.error("Error parsing listing ID:",e)}}async function ct(){const e=T("user").name;L();try{const a=await J(e),n=Array.isArray(a.data)?a.data:[];if(n.length===0){console.warn("No listings found in the response.");return}n.forEach(o=>{E(o)})}catch(a){console.error("Error reading all listings:",a)}finally{C()}}export{ct as a,ot as b,rt as c,j as d,dt as e,B as f,E as g,it as h,st as o};
